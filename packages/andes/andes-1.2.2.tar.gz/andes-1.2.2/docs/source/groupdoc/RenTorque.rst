.. _RenTorque:

================================================================================
RenTorque
================================================================================

    Renewable torque (Pref) controller.
    

Common Parameters: u, name

Available models:
WTTQA1_

.. _WTTQA1:

--------------------------------------------------------------------------------
WTTQA1
--------------------------------------------------------------------------------

Group RenTorque_


    Wind turbine generator torque (Pref) model.

    PI state freeze following voltage dip has not been implemented.

    Resets `wg` in `REECA1` model to 1.0 when torque model is connected.
    This effectively ignores `PFLAG` of `REECA1`.
    
Parameters

+--------+------------------+-------------------------------------+---------+--------+-----------+------------+
|  Name  |      Symbol      |             Description             | Default |  Unit  |   Type    | Properties |
+========+==================+=====================================+=========+========+===========+============+
|  idx   |                  | unique device idx                   |         |        | DataParam |            |
+--------+------------------+-------------------------------------+---------+--------+-----------+------------+
|  u     | :math:`u`        | connection status                   | 1       | *bool* | NumParam  |            |
+--------+------------------+-------------------------------------+---------+--------+-----------+------------+
|  name  |                  | device name                         |         |        | DataParam |            |
+--------+------------------+-------------------------------------+---------+--------+-----------+------------+
|  rep   |                  | RenPitch controller idx             |         |        | IdxParam  | mandatory  |
+--------+------------------+-------------------------------------+---------+--------+-----------+------------+
|  Kip   | :math:`K_{ip}`   | Pref-control integral gain          | 0.100   | *p.u.* | NumParam  |            |
+--------+------------------+-------------------------------------+---------+--------+-----------+------------+
|  Kpp   | :math:`K_{pp}`   | Pref-control proportional gain      | 0       | *p.u.* | NumParam  |            |
+--------+------------------+-------------------------------------+---------+--------+-----------+------------+
|  Tp    | :math:`T_p`      | Pe sensing time const.              | 0.050   | *s*    | NumParam  |            |
+--------+------------------+-------------------------------------+---------+--------+-----------+------------+
|  Twref | :math:`T_{wref}` | Speed reference time const.         | 30      | *s*    | NumParam  |            |
+--------+------------------+-------------------------------------+---------+--------+-----------+------------+
|  Temax | :math:`T_{emax}` | Max. electric torque                | 1.200   | *p.u.* | NumParam  | power      |
+--------+------------------+-------------------------------------+---------+--------+-----------+------------+
|  Temin | :math:`T_{emin}` | Min. electric torque                | 0       | *p.u.* | NumParam  | power      |
+--------+------------------+-------------------------------------+---------+--------+-----------+------------+
|  Tflag |                  | Tflag; 1-power error, 0-speed error |         | *bool* | NumParam  | mandatory  |
+--------+------------------+-------------------------------------+---------+--------+-----------+------------+
|  p1    | :math:`p_1`      | Active power point 1                | 0.200   | *p.u.* | NumParam  | power      |
+--------+------------------+-------------------------------------+---------+--------+-----------+------------+
|  sp1   | :math:`s_{p1}`   | Speed power point 1                 | 0.580   | *p.u.* | NumParam  |            |
+--------+------------------+-------------------------------------+---------+--------+-----------+------------+
|  p2    | :math:`p_2`      | Active power point 2                | 0.400   | *p.u.* | NumParam  | power      |
+--------+------------------+-------------------------------------+---------+--------+-----------+------------+
|  sp2   | :math:`s_{p2}`   | Speed power point 2                 | 0.720   | *p.u.* | NumParam  |            |
+--------+------------------+-------------------------------------+---------+--------+-----------+------------+
|  p3    | :math:`p_3`      | Active power point 3                | 0.600   | *p.u.* | NumParam  | power      |
+--------+------------------+-------------------------------------+---------+--------+-----------+------------+
|  sp3   | :math:`s_{p3}`   | Speed power point 3                 | 0.860   | *p.u.* | NumParam  |            |
+--------+------------------+-------------------------------------+---------+--------+-----------+------------+
|  p4    | :math:`p_4`      | Active power point 4                | 0.800   | *p.u.* | NumParam  | power      |
+--------+------------------+-------------------------------------+---------+--------+-----------+------------+
|  sp4   | :math:`s_{p4}`   | Speed power point 4                 | 1       | *p.u.* | NumParam  |            |
+--------+------------------+-------------------------------------+---------+--------+-----------+------------+
|  rea   |                  |                                     | 0       |        | ExtParam  |            |
+--------+------------------+-------------------------------------+---------+--------+-----------+------------+
|  rego  |                  |                                     | 0       |        | ExtParam  |            |
+--------+------------------+-------------------------------------+---------+--------+-----------+------------+
|  ree   |                  |                                     | 0       |        | ExtParam  |            |
+--------+------------------+-------------------------------------+---------+--------+-----------+------------+
|  reg   |                  |                                     | 0       |        | ExtParam  |            |
+--------+------------------+-------------------------------------+---------+--------+-----------+------------+
|  Sn    | :math:`S_n`      |                                     | 0       |        | ExtParam  |            |
+--------+------------------+-------------------------------------+---------+--------+-----------+------------+
|  w0    | :math:`\omega_0` |                                     | 0       |        | ExtParam  |            |
+--------+------------------+-------------------------------------+---------+--------+-----------+------------+

Variables

+---------+---------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------------------------------------+------+----------------+
|  Name   |       Symbol        |                                                                                                                                                                          Initial Value                                                                                                                                                                          |              Description              | Unit |   Properties   |
+=========+=====================+=================================================================================================================================================================================================================================================================================================================================================================+=======================================+======+================+
|  s1_y   | :math:`y_{s_1}`     | :math:`1.0 P_{e}`                                                                                                                                                                                                                                                                                                                                               | State in lag transfer function        |      | v_str          |
+---------+---------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------------------------------------+------+----------------+
|  s2_y   | :math:`y_{s_2}`     | :math:`1.0 y_{f_{Pe}}`                                                                                                                                                                                                                                                                                                                                          | State in lag transfer function        |      | v_str          |
+---------+---------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------------------------------------+------+----------------+
|  PI_xi  | :math:`xi_{PI}`     | :math:`\frac{P_{ref0}}{y_{f_{Pe}}}`                                                                                                                                                                                                                                                                                                                             | Integrator output                     |      | v_str          |
+---------+---------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------------------------------------+------+----------------+
|  wg     | :math:`\omega_g`    | :math:`y_{f_{Pe}}`                                                                                                                                                                                                                                                                                                                                              |                                       |      | v_str,v_setter |
+---------+---------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------------------------------------+------+----------------+
|  wt     | :math:`\omega_t`    | :math:`y_{f_{Pe}}`                                                                                                                                                                                                                                                                                                                                              |                                       |      | v_str,v_setter |
+---------+---------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------------------------------------+------+----------------+
|  s3_y   | :math:`y_{s3}`      | :math:`\frac{P_{ref0}}{K_{shaft} \omega_g}`                                                                                                                                                                                                                                                                                                                     |                                       |      | v_str,v_setter |
+---------+---------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------------------------------------+------+----------------+
|  fPe_y  | :math:`y_{f_{Pe}}`  | :math:`\begin{cases} s_{p1} & \text{for}\: p_{1} \geq y_{s_1} \\k_{p1} \left(- p_{1} + y_{s_1}\right) + s_{p1} & \text{for}\: p_{2} \geq y_{s_1} \\k_{p2} \left(- p_{2} + y_{s_1}\right) + s_{p2} & \text{for}\: p_{3} \geq y_{s_1} \\k_{p3} \left(- p_{3} + y_{s_1}\right) + s_{p3} & \text{for}\: p_{4} \geq y_{s_1} \\s_{p4} & \text{otherwise} \end{cases}` | Output of piecewise                   |      | v_str          |
+---------+---------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------------------------------------+------+----------------+
|  Tsel   | :math:`T_{sel}`     | :math:`SWT_{s0} \left(- \omega_g + y_{s_2}\right) + \frac{SWT_{s1} \left(P_{e} - P_{ref0}\right)}{\omega_g}`                                                                                                                                                                                                                                                    | Output after Tflag selector           |      | v_str          |
+---------+---------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------------------------------------+------+----------------+
|  PI_yul | :math:`y^{ul}_{PI}` | :math:`K_{pp} T_{sel} + \frac{P_{ref0}}{y_{f_{Pe}}}`                                                                                                                                                                                                                                                                                                            |                                       |      | v_str          |
+---------+---------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------------------------------------+------+----------------+
|  PI_y   | :math:`y_{PI}`      | :math:`\pi_{hl zi} y^{ul}_{PI} + \pi_{hl zl} T_{emin} + \pi_{hl zu} T_{emax}`                                                                                                                                                                                                                                                                                   | PI output                             |      | v_str          |
+---------+---------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------------------------------------+------+----------------+
|  Pe     | :math:`P_{e}`       |                                                                                                                                                                                                                                                                                                                                                                 |                                       |      |                |
+---------+---------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------------------------------------+------+----------------+
|  wr0    | :math:`\omega_{r0}` | :math:`y_{f_{Pe}}`                                                                                                                                                                                                                                                                                                                                              | Retrieved initial w0 from RenGovernor |      | v_str,v_setter |
+---------+---------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------------------------------------+------+----------------+
|  wge    | :math:`\omega_{ge}` | :math:`1.0`                                                                                                                                                                                                                                                                                                                                                     |                                       |      | v_str,v_setter |
+---------+---------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------------------------------------+------+----------------+
|  Pref   | :math:`P_{ref}`     | :math:`\omega_g y_{PI}`                                                                                                                                                                                                                                                                                                                                         |                                       |      | v_str,v_setter |
+---------+---------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------------------------------------+------+----------------+

Differential Equations

+--------+------------------+----------+----------------------------------+------------------+
|  Name  |      Symbol      |   Type   | RHS of Equation "T x' = f(x, y)" |     T (LHS)      |
+========+==================+==========+==================================+==================+
|  s1_y  | :math:`y_{s_1}`  | State    | :math:`1.0 P_{e} - y_{s_1}`      | :math:`T_p`      |
+--------+------------------+----------+----------------------------------+------------------+
|  s2_y  | :math:`y_{s_2}`  | State    | :math:`1.0 y_{f_{Pe}} - y_{s_2}` | :math:`T_{wref}` |
+--------+------------------+----------+----------------------------------+------------------+
|  PI_xi | :math:`xi_{PI}`  | State    | :math:`K_{ip} T_{sel}`           |                  |
+--------+------------------+----------+----------------------------------+------------------+
|  wg    | :math:`\omega_g` | ExtState | :math:`0`                        |                  |
+--------+------------------+----------+----------------------------------+------------------+
|  wt    | :math:`\omega_t` | ExtState | :math:`0`                        |                  |
+--------+------------------+----------+----------------------------------+------------------+
|  s3_y  | :math:`y_{s3}`   | ExtState | :math:`0`                        |                  |
+--------+------------------+----------+----------------------------------+------------------+

Algebraic Equations

+---------+---------------------+----------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|  Name   |       Symbol        |   Type   |                                                                                                                                                                         RHS of Equation "0 = g(x, y)"                                                                                                                                                                          |
+=========+=====================+==========+================================================================================================================================================================================================================================================================================================================================================================================+
|  fPe_y  | :math:`y_{f_{Pe}}`  | Algeb    | :math:`- y_{f_{Pe}} + \begin{cases} s_{p1} & \text{for}\: p_{1} \geq y_{s_1} \\k_{p1} \left(- p_{1} + y_{s_1}\right) + s_{p1} & \text{for}\: p_{2} \geq y_{s_1} \\k_{p2} \left(- p_{2} + y_{s_1}\right) + s_{p2} & \text{for}\: p_{3} \geq y_{s_1} \\k_{p3} \left(- p_{3} + y_{s_1}\right) + s_{p3} & \text{for}\: p_{4} \geq y_{s_1} \\s_{p4} & \text{otherwise} \end{cases}` |
+---------+---------------------+----------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|  Tsel   | :math:`T_{sel}`     | Algeb    | :math:`SWT_{s0} \left(- \omega_g + y_{s_2}\right) + \frac{SWT_{s1} \left(P_{e} - P_{ref0}\right)}{\omega_g} - T_{sel}`                                                                                                                                                                                                                                                         |
+---------+---------------------+----------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|  PI_yul | :math:`y^{ul}_{PI}` | Algeb    | :math:`K_{pp} T_{sel} + xi_{PI} - y^{ul}_{PI}`                                                                                                                                                                                                                                                                                                                                 |
+---------+---------------------+----------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|  PI_y   | :math:`y_{PI}`      | Algeb    | :math:`\pi_{hl zi} y^{ul}_{PI} + \pi_{hl zl} T_{emin} + \pi_{hl zu} T_{emax} - y_{PI}`                                                                                                                                                                                                                                                                                         |
+---------+---------------------+----------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|  Pe     | :math:`P_{e}`       | ExtAlgeb | :math:`0`                                                                                                                                                                                                                                                                                                                                                                      |
+---------+---------------------+----------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|  wr0    | :math:`\omega_{r0}` | ExtAlgeb | :math:`- \omega_0 + y_{f_{Pe}}`                                                                                                                                                                                                                                                                                                                                                |
+---------+---------------------+----------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|  wge    | :math:`\omega_{ge}` | ExtAlgeb | :math:`1 - y_{f_{Pe}}`                                                                                                                                                                                                                                                                                                                                                         |
+---------+---------------------+----------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|  Pref   | :math:`P_{ref}`     | ExtAlgeb | :math:`- \frac{P_{ref0}}{\omega_{ge}} + \omega_g y_{PI}`                                                                                                                                                                                                                                                                                                                       |
+---------+---------------------+----------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

Services

+------+----------------+---------------------------------------------------+--------------+
| Name |     Symbol     |                     Equation                      |     Type     |
+======+================+===================================================+==============+
|  kp1 | :math:`k_{p1}` | :math:`\frac{- s_{p1} + s_{p2}}{- p_{1} + p_{2}}` | ConstService |
+------+----------------+---------------------------------------------------+--------------+
|  kp2 | :math:`k_{p2}` | :math:`\frac{- s_{p2} + s_{p3}}{- p_{2} + p_{3}}` | ConstService |
+------+----------------+---------------------------------------------------+--------------+
|  kp3 | :math:`k_{p3}` | :math:`\frac{- s_{p3} + s_{p4}}{- p_{3} + p_{4}}` | ConstService |
+------+----------------+---------------------------------------------------+--------------+

Discrete

+--------+-----------------+-------------+------+
|  Name  |     Symbol      |    Type     | Info |
+========+=================+=============+======+
|  SWT   | :math:`SW_{T}`  | Switcher    |      |
+--------+-----------------+-------------+------+
|  PI_aw | :math:`aw_{PI}` | AntiWindup  |      |
+--------+-----------------+-------------+------+
|  PI_hl | :math:`hl_{PI}` | HardLimiter |      |
+--------+-----------------+-------------+------+

Blocks

+------+----------------+---------------+------------------------------+
| Name |     Symbol     |     Type      |             Info             |
+======+================+===============+==============================+
|  s1  | :math:`s_1`    | Lag           | Pe filter                    |
+------+----------------+---------------+------------------------------+
|  fPe | :math:`f_{Pe}` | Piecewise     | Piecewise Pe to wref mapping |
+------+----------------+---------------+------------------------------+
|  s2  | :math:`s_2`    | Lag           | speed filter                 |
+------+----------------+---------------+------------------------------+
|  PI  | :math:`PI`     | PIAWHardLimit | PI controller                |
+------+----------------+---------------+------------------------------+


