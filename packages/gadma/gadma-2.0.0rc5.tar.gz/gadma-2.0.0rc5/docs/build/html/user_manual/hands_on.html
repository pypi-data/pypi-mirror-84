

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Hands on &mdash; GADMA 2.0.0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="User manual" href="user_manual.html" />
    <link rel="prev" title="Installation" href="installation.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> GADMA
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">User documentation</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Hands on</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#test-case">Test case</a></li>
<li class="toctree-l2"><a class="reference internal" href="#example-2">Example 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="#example-3">Example 3</a></li>
<li class="toctree-l2"><a class="reference internal" href="#example-4">Example 4</a></li>
<li class="toctree-l2"><a class="reference internal" href="#example-5">Example 5</a></li>
<li class="toctree-l2"><a class="reference internal" href="#example-6">Example 6</a></li>
<li class="toctree-l2"><a class="reference internal" href="#example-7">Example 7</a></li>
<li class="toctree-l2"><a class="reference internal" href="#example-8">Example 8</a></li>
<li class="toctree-l2"><a class="reference internal" href="#example-yri-ceu">Example YRI, CEU</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="user_manual.html">User manual</a></li>
<li class="toctree-l1"><a class="reference internal" href="example_params_file.html">Example parameters file</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples/examples.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_help.html">Getting help</a></li>
</ul>
<p class="caption"><span class="caption-text">Development documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../api/gadma.html">API</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">GADMA</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>Hands on</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/user_manual/hands_on.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="hands-on">
<h1>Hands on<a class="headerlink" href="#hands-on" title="Permalink to this headline">¶</a></h1>
<div class="section" id="test-case">
<h2>Test case<a class="headerlink" href="#test-case" title="Permalink to this headline">¶</a></h2>
<p>GADMA has a test case for a simple demographic model for one population: just a constant size of $10000$ individuals in population. To run a test case:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> gadma --test
</pre></div>
</div>
</div>
<div class="section" id="example-2">
<h2>Example 2<a class="headerlink" href="#example-2" title="Permalink to this headline">¶</a></h2>
<p>Suppose we have SNP data for two populations. Data is in dadi’s SNP file format in the <code class="docutils literal notranslate"><span class="pre">snp_data.txt</span></code>. Suppose we want to get all output in some <code class="docutils literal notranslate"><span class="pre">gadma_output</span></code> directory:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> gadma -i snp_data.txt -o gadma_output
</pre></div>
</div>
</div>
<div class="section" id="example-3">
<h2>Example 3<a class="headerlink" href="#example-3" title="Permalink to this headline">¶</a></h2>
<p>We didn’t specify AFS size or labels for populations, they are taken automatically from the input file. We can see a parameter file of our run in the <code class="docutils literal notranslate"><span class="pre">gadma_output/param_file</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># gadma_output/param_file</span>
<span class="o">...</span>
<span class="n">Population</span> <span class="n">labels</span> <span class="p">:</span> <span class="n">pop_name_1</span><span class="p">,</span> <span class="n">pop_name_2</span>
<span class="n">Projections</span><span class="p">:</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">20</span>
<span class="o">...</span>
</pre></div>
</div>
<p>But we know that spectrum should be <code class="docutils literal notranslate"><span class="pre">20</span> <span class="pre">x</span> <span class="pre">20</span></code>! To specify size of AFS we need to create a parameter file and set <code class="docutils literal notranslate"><span class="pre">Projections</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># param_file</span>
<span class="n">Projections</span> <span class="p">:</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">20</span>
</pre></div>
</div>
<p>Order of populations can be changed as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># param_file</span>
<span class="n">Projections</span> <span class="p">:</span> <span class="mi">20</span><span class="p">,</span><span class="mi">20</span>
<span class="n">Population</span> <span class="n">labels</span> <span class="p">:</span> <span class="n">pop_name_2</span><span class="p">,</span> <span class="n">pop_name_1</span>
</pre></div>
</div>
<p>If we want to rename populations, we should change names on <code class="docutils literal notranslate"><span class="pre">snp_data.txt</span></code> file.</p>
<p>Now assume we want to get the simplest demographic model as fast as we can. We will tell GADMA that we need no other dynamics of population sizes except sudden (constant) population size change and that we want to use <em>moments</em> library.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># param_file</span>
<span class="n">Projections</span> <span class="p">:</span> <span class="mi">20</span><span class="p">,</span><span class="mi">20</span>
<span class="n">Population</span> <span class="n">labels</span> <span class="p">:</span> <span class="n">pop_name_2</span><span class="p">,</span> <span class="n">pop_name_1</span>
<span class="n">Only</span> <span class="n">sudden</span> <span class="p">:</span> <span class="kc">True</span>
<span class="n">Engine</span> <span class="p">:</span> <span class="n">moments</span>
</pre></div>
</div>
<p>To run GADMA we need to specify <code class="docutils literal notranslate"><span class="pre">-p/--params</span></code> command-line option in cmd:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> gadma -i snp_data.txt -o gadma_output -p params_file
</pre></div>
</div>
</div>
<div class="section" id="example-4">
<h2>Example 4<a class="headerlink" href="#example-4" title="Permalink to this headline">¶</a></h2>
<p>Consider some AFS file <code class="docutils literal notranslate"><span class="pre">fs_data.fs</span></code>. There is a spectrum for three populations: YRI, CEU, CHB. However axes are mixed up: CHB, YRI, CEU. To run GADMA we should order them from most ancient to most recent:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># param_file</span>
<span class="n">Population</span> <span class="n">labels</span> <span class="p">:</span> <span class="n">YRI</span><span class="p">,</span> <span class="n">CEU</span><span class="p">,</span> <span class="n">CHB</span>
</pre></div>
</div>
<p>We want to allow exponential growth (it is the default behaviour) and have some extra changes in size of the ancient population. To do so we should specify <code class="docutils literal notranslate"><span class="pre">Initial</span> <span class="pre">structure</span></code>. It is list of three numbers: first - number of time intervals before first split (we want here 2); second - number of time periods between first and second split events (at least 1); third - number of time periods after second split.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># param_file</span>
<span class="n">Population</span> <span class="n">labels</span> <span class="p">:</span> <span class="n">YRI</span><span class="p">,</span> <span class="n">CEU</span><span class="p">,</span> <span class="n">CHB</span>
<span class="n">Initial</span> <span class="n">structure</span> <span class="p">:</span> <span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span>
</pre></div>
</div>
<p>Also we can put information about input file and output directory to our parameter file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># param_file</span>
<span class="n">Input</span> <span class="n">file</span> <span class="p">:</span> <span class="n">fs_data</span><span class="o">.</span><span class="n">fs</span>
<span class="n">Output</span> <span class="n">directory</span> <span class="p">:</span> <span class="n">gadma_output</span>
<span class="n">Population</span> <span class="n">labels</span> <span class="p">:</span> <span class="n">YRI</span><span class="p">,</span> <span class="n">CEU</span><span class="p">,</span> <span class="n">CHB</span>
<span class="n">Initial</span> <span class="n">structure</span> <span class="p">:</span> <span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span>
</pre></div>
</div>
<p>Now we can run GADMA in the following way:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> gadma -p params
</pre></div>
</div>
</div>
<div class="section" id="example-5">
<h2>Example 5<a class="headerlink" href="#example-5" title="Permalink to this headline">¶</a></h2>
<p>We have our GADMA launch interrupted for some reasons. We want to resume it:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> gadma --resume gadma_output
</pre></div>
</div>
<p>where <code class="docutils literal notranslate"><span class="pre">gadma_output</span></code> is output directory of previous run. We can find resumed run in <code class="docutils literal notranslate"><span class="pre">gadma_output_resumed</span></code></p>
</div>
<div class="section" id="example-6">
<h2>Example 6<a class="headerlink" href="#example-6" title="Permalink to this headline">¶</a></h2>
<p>Our launch was finished, we used dadi with a default grid size which GADMA determines automatically if it is not specified by user. We found out that it would be better to find some models using greater number of grid points in dadi scheme, but we want to take final models from previous run:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># param_file</span>
<span class="n">Pts</span> <span class="p">:</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">60</span> <span class="c1">#Greater value of grid size than it was</span>
</pre></div>
</div>
<p>And run GADMA:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> gadma --resume gadma_output --only_models -p params
</pre></div>
</div>
<p>Option <code class="docutils literal notranslate"><span class="pre">--only_models</span></code> tells GADMA to take from <code class="docutils literal notranslate"><span class="pre">gadma_output</span></code> final models only.</p>
<p>There is another way to do the same:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># param_file</span>
<span class="n">Resume</span> <span class="kn">from</span> <span class="p">:</span> <span class="n">gadma_output</span>
<span class="n">Only</span> <span class="n">models</span> <span class="p">:</span> <span class="kc">True</span>
<span class="n">Pts</span> <span class="p">:</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">60</span> <span class="c1">#Greater value of grid size than it was</span>
</pre></div>
</div>
<p>And run GADMA in the following way:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> gadma -p params
</pre></div>
</div>
</div>
<div class="section" id="example-7">
<h2>Example 7<a class="headerlink" href="#example-7" title="Permalink to this headline">¶</a></h2>
<p>We can add a custom model using a parameter <code class="docutils literal notranslate"><span class="pre">Custom</span> <span class="pre">filename</span></code> in the parameter file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># param_file</span>
<span class="n">Custom</span> <span class="n">filename</span> <span class="p">:</span> <span class="n">YRI_CEU_demographic_model</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<p>Our custom file need to contain a function with a fixed name <code class="docutils literal notranslate"><span class="pre">model_func</span></code>. For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># YRI_CEU_demographic_model.py</span>
<span class="k">def</span> <span class="nf">model_func</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">ns</span><span class="p">,</span> <span class="n">pts</span><span class="p">)</span>
    <span class="n">nu1F</span><span class="p">,</span> <span class="n">nu2B</span><span class="p">,</span> <span class="n">nu2F</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">Tp</span><span class="p">,</span> <span class="n">T</span> <span class="o">=</span> <span class="n">params</span>
    <span class="n">n1</span><span class="p">,</span> <span class="n">n2</span> <span class="o">=</span> <span class="n">ns</span>
    <span class="n">xx</span> <span class="o">=</span> <span class="n">yy</span> <span class="o">=</span> <span class="n">dadi</span><span class="o">.</span><span class="n">Numerics</span><span class="o">.</span><span class="n">default_grid</span><span class="p">(</span><span class="n">pts</span><span class="p">)</span>

    <span class="n">phi</span> <span class="o">=</span> <span class="n">dadi</span><span class="o">.</span><span class="n">PhiManip</span><span class="o">.</span><span class="n">phi_1D</span><span class="p">(</span><span class="n">xx</span><span class="p">)</span>
    <span class="n">phi</span> <span class="o">=</span> <span class="n">dadi</span><span class="o">.</span><span class="n">Integration</span><span class="o">.</span><span class="n">one_pop</span><span class="p">(</span><span class="n">phi</span><span class="p">,</span> <span class="n">xx</span><span class="p">,</span> <span class="n">Tp</span><span class="p">,</span> <span class="n">nu</span><span class="o">=</span><span class="n">nu1F</span><span class="p">)</span>

    <span class="n">phi</span> <span class="o">=</span> <span class="n">dadi</span><span class="o">.</span><span class="n">PhiManip</span><span class="o">.</span><span class="n">phi_1D_to_2D</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span> <span class="n">phi</span><span class="p">)</span>
    <span class="n">nu2_func</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">t</span><span class="p">:</span> <span class="n">nu2B</span><span class="o">*</span><span class="p">(</span><span class="n">nu2F</span><span class="o">/</span><span class="n">nu2B</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="n">t</span><span class="o">/</span><span class="n">T</span><span class="p">)</span>
    <span class="n">phi</span> <span class="o">=</span> <span class="n">dadi</span><span class="o">.</span><span class="n">Integration</span><span class="o">.</span><span class="n">two_pops</span><span class="p">(</span><span class="n">phi</span><span class="p">,</span> <span class="n">xx</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">nu1</span><span class="o">=</span><span class="n">nu1F</span><span class="p">,</span>
                                    <span class="n">nu2</span><span class="o">=</span><span class="n">nu2_func</span><span class="p">,</span> <span class="n">m12</span><span class="o">=</span><span class="n">m</span><span class="p">,</span> <span class="n">m21</span><span class="o">=</span><span class="n">m</span><span class="p">)</span>

    <span class="n">sfs</span> <span class="o">=</span> <span class="n">dadi</span><span class="o">.</span><span class="n">Spectrum</span><span class="o">.</span><span class="n">from_phi</span><span class="p">(</span><span class="n">phi</span><span class="p">,</span> <span class="p">(</span><span class="n">n1</span><span class="p">,</span><span class="n">n2</span><span class="p">),</span> <span class="p">(</span><span class="n">xx</span><span class="p">,</span><span class="n">yy</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">sfs</span>
</pre></div>
</div>
<p>In addition, we can easily specify values for lower and upper bounds through a parameter file. Let’s set lower and upper bounds for the model we defined above:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># param_file</span>
<span class="n">Lower</span> <span class="n">bounds</span> <span class="p">:</span> <span class="mf">1e-2</span><span class="p">,</span> <span class="mf">1e-2</span><span class="p">,</span> <span class="mf">1e-2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
<span class="n">Upper</span> <span class="n">bounds</span> <span class="p">:</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span>
</pre></div>
</div>
</div>
<div class="section" id="example-8">
<h2>Example 8<a class="headerlink" href="#example-8" title="Permalink to this headline">¶</a></h2>
<p>Also, we can get the values of lower/upper bounds, both, or none of them in the parameter file automatically. For this, each identifier in the parameter file must be declared through a parameter <code class="docutils literal notranslate"><span class="pre">Parameter</span> <span class="pre">identifiers</span></code>. Below is an identifier list:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># param_file</span>
<span class="c1">#   if identifier starts with letter:</span>
<span class="c1">#   T/t - time</span>
<span class="c1">#   N/n - size of population</span>
<span class="c1">#   M/m - migration</span>
<span class="c1">#   S/s/F/f - split event, proportion in which population size</span>
<span class="c1">#             is divided to form two new populations.</span>
<span class="c1">#   G/g - selection</span>
<span class="c1">#   H/h - dominance coefficient for selection.</span>
</pre></div>
</div>
<p>For example, we set a lower bound for the model we defined above (see Example 7) and we want to get an upper bound automatically.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># param_file</span>
<span class="n">Lower</span> <span class="n">bound</span> <span class="p">:</span> <span class="mf">1e-2</span><span class="p">,</span> <span class="mf">1e-2</span><span class="p">,</span> <span class="mf">1e-2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
<span class="n">Upper</span> <span class="n">bound</span> <span class="p">:</span> <span class="kc">None</span>

<span class="n">Parameter</span> <span class="n">identifiers</span> <span class="p">:</span> <span class="n">nu1F</span><span class="p">,</span> <span class="n">nu2B</span><span class="p">,</span> <span class="n">nu2F</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">Tp</span><span class="p">,</span> <span class="n">T</span>
</pre></div>
</div>
<p>If the custom function has first line line <code class="docutils literal notranslate"><span class="pre">par1,</span> <span class="pre">par2,</span> <span class="pre">...</span> <span class="pre">=</span> <span class="pre">params</span></code> then option <code class="docutils literal notranslate"><span class="pre">Parameter</span> <span class="pre">identifiers</span></code> could be missed and GADMA will take this option from the function.</p>
</div>
<div class="section" id="example-yri-ceu">
<h2>Example YRI, CEU<a class="headerlink" href="#example-yri-ceu" title="Permalink to this headline">¶</a></h2>
<p>GADMA has an example of the parameter file <code class="docutils literal notranslate"><span class="pre">example_params</span></code>. To run GADMA with this parameters one should just run from the GADMA’s home directory:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> gadma -p example_params
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="user_manual.html" class="btn btn-neutral float-right" title="User manual" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="installation.html" class="btn btn-neutral float-left" title="Installation" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, Ekaterina Noskova

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>